<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
   <meta name="apple-mobile-web-app-capable" content="yes" />
   <meta name="apple-mobile-web-app-status-bar-style" content="black" />
   <!-- <link rel="apple-touch-icon" href="http://s0-weizhifeng-net.b0.upaiyun.com/touch-icon-iphone.png" /> -->
   <link rel="apple-touch-icon-precomposed" href="http://s0-weizhifeng-net.b0.upaiyun.com/touch-icon-iphone-precomposed.png" />
   <link rel="apple-touch-icon" sizes="72x72" href="http://s0-weizhifeng-net.b0.upaiyun.com/touch-icon-ipad.png" />
   <link rel="apple-touch-icon" sizes="114x114" href="http://s0-weizhifeng-net.b0.upaiyun.com/touch-icon-iphone-retina.png" />
   <link rel="apple-touch-icon" sizes="144x144" href="http://s0-weizhifeng-net.b0.upaiyun.com/touch-icon-ipad-retina.png" />
   
   <title>理解Node.js</title>
   <meta name="author" content="Jeremy Wei" />
   <link href="http://feeds.feedburner.com/JeremyWei" rel="alternate" title="Jeremy Wei" type="application/atom+xml" />
   <link rel="shortcut icon" type="image/x-icon" href="http://s0-weizhifeng-net.b0.upaiyun.com/favicon.ico">
      
   <!-- Homepage CSS -->
   <link rel="stylesheet" href="http://s0-weizhifeng-net.b0.upaiyun.com/css/screen.css?0904" type="text/css" media="screen, projection" />
   <!-- <link rel="stylesheet" href="/css/screen.css?0904" type="text/css" media="screen, projection" /> -->
   
   <script type="text/javascript" charset="utf-8">
   // Mobile Safari in standalone mode
   if(("standalone" in window.navigator) && window.navigator.standalone){
	   
   	// If you want to prevent remote links in standalone web apps opening Mobile Safari, change 'remotes' to true
   	var noddy, remotes = true;
	
   	document.addEventListener('click', function(event) {
		
   		noddy = event.target;
		
   		// Bubble up until we hit link or top HTML element. Warning: BODY element is not compulsory so better to stop on HTML
   		while(noddy.nodeName !== "A" && noddy.nodeName !== "HTML") {
   	        noddy = noddy.parentNode;
   	    }
		
   		if('href' in noddy && noddy.href.indexOf('http') !== -1 && (noddy.href.indexOf(document.location.host) !== -1 || remotes))
   		{
   			event.preventDefault();
   			document.location.href = noddy.href;
   		}
	
   	},false);
   }
   </script>
</head>
<body>
	
<div class="site">
  <pre class="nav margin-for-mobile">["<a href='/tech.html'>编程</a>", "<a href='/design.html'>设计</a>", "<a href='/poem.html'>诗词</a>", "<a href='/5000years.html'>历史</a>", "<a href='/resume.html'>关于</a>"]</pre>
  <br />
  <div id="post">
	<h1>理解Node.js</h1>
	<div class="copyright">
	作者: JeremyWei | 可以转载, 但必须以超链接形式标明文章原始出处和作者信息及版权声明<br />
	网址: http://weizhifeng.net/understanding-node-js.html
	</div>

	<p>原文：<a href="http://debuggable.com/posts/understanding-node-js:4bd98440-45e4-4a9a-8ef7-0f7ecbdd56cb">http://debuggable.com/posts/understanding-node-js:4bd98440-45e4-4a9a-8ef7-0f7ecbdd56cb</a></p>

<p>当我把<a href="http://nodejs.org/">Node.js</a>介绍给人们的时候，通常会产生两种反应。总的来说人们不是可以正确的理解它，就是被搞得非常糊涂。</p>

<p>如果你到目前为止还处于第二组里，下面是我想要用来讲解node的内容：</p>

<ul>
<li>它是一个命令行工具。你下载一个tarball文件，编译并安装源码。</li>
<li>它可以让你在你的终端中通过输入'node my_app.js'来运行JavaScript程序。</li>
<li>JS是被<a href="http://code.google.com/p/v8/">V8 javascript引擎</a>（使Google Chrome运行如此之快的东西）所执行的。</li>
<li>Node提供了一个用来访问网络和文件系统的JavaScript API。</li>
</ul>


<p><strong>“但是我可以做任何我想要做的事情用：ruby，python，php，java， ... ！”</strong></p>

<p>我听到了你的声音。你是对的。Node不是该死的独角兽，它不会帮你做你自己的工作，抱歉。它只是一个工具，并且它大概也不会完全地替换你常用的工具，至少当前不会。</p>

<p><strong>“说重点！”</strong></p>

<p>好的，我会的。Node总的来说非常优秀当你需要同时做许多事情的时候。你有过写了一部分代码然后说“我想要这个并行执行”吗？好吧，在node中任何东西都是并行运行的，除了你的代码。</p>

<p><strong>“嘿？”</strong></p>

<p>是的没错，任何东西都是并行的，除了你的代码。为了理解它，把你的代码想像成是国王，然后node是它的仆从军队。</p>

<p>新的一天以仆从叫醒国王并且问他是否需要什么而开始了。国王给了这个仆从一个任务列表，然后回去继续睡觉去了（汗）。这个仆从把这些任务分配给了他的同僚，然后他们开始工作。</p>

<p>当一个仆从完成了一个任务，他会在国王领地外边排成一条线来汇报。国王一次让一个仆从进来，然后听取他的报告。有时候国王会在仆从出去的时候给仆从更多的任务。</p>

<p>生活是美好的，因为国王的仆从并行的执行他的任务，但是一次只报告一个结果，所以国王可以专注。*</p>

<p><strong>“那是异想天开，但是你能结束这个愚蠢的比喻并且用geek的方式告诉我吗？”</strong></p>

<p>当然。一个简单的node程序看起来可能是这样的：</p>

<pre><code>var fs = require('fs')
  , sys = require('sys');

fs.readFile('treasure-chamber-report.txt', function(report) {
  sys.puts("oh, look at all my money: "+report);
});

fs.writeFile('letter-to-princess.txt', '...', function() {
  sys.puts("can't wait to hear back from her!");
});
</code></pre>

<p>你的代码给了node两个任务用来读写一个文件，然后就休眠了。当node完成了一个任务，跟它对应的回调就会被触发。但是在同一时间只能有一个回调触发。在那个回调完成了执行之前，所有其他的回调不得不排队等待。进一步说，对于回调触发的顺序是无法保证的。</p>

<p><strong>“所以我不必担心代码在同一时间访问同一个数据结构？”</strong></p>

<p>你理解了！这就是JavaScript的单进程/事件循环设计的全部美之所在。</p>

<p><strong>“非常好，但是为什么我应该用它？”</strong></p>

<p>一个原因是效率。在一个web应用中，你主要的响应时间消耗通常是执行数据库查询的时间之和。通过node，你可以一次执行你所有的查询，把响应时间减少为执行最慢查询所花费的时间。</p>

<p>另一个原因是JavaScript。你可以使用node来在浏览器和你的后端之间共享代码。JavaScript也正在变成一个真的通用语言。不管过去你用的是python，ruby，java，php或者其他语言，你都可能用过一些JS，对吗？</p>

<p>最后一个原因是原始速度。V8时刻在向成为全球最快的动态语言解释器之一而努力。我想不到任何其他语言在速度上有像如今的JavaScript一样有如此突飞猛进的提升。进一步说，node的I/O能力非常轻量级，可以使你可以尽可能的完全利用你系统完全的I/O能力。</p>

<p><strong>“所以你在说我应该从现在起用node来写我所有的应用？”</strong></p>

<p>是和不是。一旦你开始抡node这个锤子，那么显然一切开始看起来都像一个钉子。但是如果你当前的工作有一个期限，你可以通过以下来决定：</p>

<ul>
<li>是否低响应时间/高并发重要？Node真的很擅长它。</li>
<li>项目有多大？小项目问题不大。大项目应该小心的评估（可用的库，修复一个bug所需的资源或者two upstream等等。）。</li>
</ul>


<p><strong>“node能运行在Windows上吗？”</strong></p>

<p>不行。如果你使用的是windows，你需要运行一个Linux虚拟机（我推荐<a href="http://www.virtualbox.org/">VirtualBox</a>）。node对Windows的支持在计划中了，但是接下来的几个月不要屏住呼吸除非你想对port提供帮助。（译者：现在node可以完美的运行在Windows上）</p>

<p><strong>“我能在node中访问DOM吗？”</strong></p>

<p>好问题！不行，DOM是浏览器中的东东，并且node的JS引擎（V8）幸好跟那些混乱的东西是完全分离的。不过，有人在以node模块的形式来实现DOM，可能带来令人兴奋的可能性比如对客户端代码进行单元测试。</p>

<p><strong>“难道事件驱动编程不是真的非常难吗？”</strong></p>

<p>这取决于你。如果你已经学过如何在浏览器中摆弄AJAX调用和用户事件，那么使用node不会是一个问题。</p>

<p>同时，测试驱动开发可以真正的帮助你以一个可维护的设计做为开始。</p>

<p><strong>“谁在用它？”</strong></p>

<p>在<a href="http://wiki.github.com/ry/node">node wiki</a>（滚动到"Companies using Node"）有一个小的/不全的列表。<a href="http://www.yuiblog.com/blog/2010/04/09/node-js-yui-3-dom-manipulation-oh-my/">Yahoo</a>正在为YUI对node进行实验，<a href="http://www.plurk.com/">Plurk</a>正在使用它处理大规模的comet，并且Paul Bakaus（由于jQuery UI而出名）正在创建一个令人兴奋的游戏引擎，其中后端使用了一些node代码。<a href="http://www.joyent.com/">Joyent</a>已经雇佣了Ryan Dahl（node作者）并且大力资助开发。</p>

<p>对了，Heroku也刚刚声明了<a href="http://blog.heroku.com/archives/2010/4/28/node_js_support_experimental/">支持对node.js的托管</a>。</p>

<p><strong>“我能去哪里学更多？”</strong></p>

<p>Tim Caswell正在运作优秀的<a href="http://howtonode.org/">How To Node</a>博客。在twitter上Follow <a href="http://search.twitter.com/search?q=%23nodejs">#nodejs</a>。订阅<a href="http://groups.google.com/group/nodejs">邮件列表</a>。然后去IRC频道逛逛，#node.js（是的，名字中包含这个点）。我们在那的划艇分数快达到200了：）。</p>

<p>我也将会继续在debuggable.com这里写文章。</p>

<p>当前就写这么多了。如果你有其他问题欢迎留言。</p>

<p>--注解：</p>

<p>*: 这个比喻显然是太简单了，但是在现实之中找到一个与非阻塞概念相对应的对照物很难。</p>

	(完)

	<div class="post-info">
		28 Oct 2013  
	
		
	
		
	</div>
	
	<!-- disqus start -->
	<div id="disqus_thread"></div>
	<script type="text/javascript">
	    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	    var disqus_shortname = 'jeremywei'; // required: replace example with your forum shortname

	    /* * * DON'T EDIT BELOW THIS LINE * * */
	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();
	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	<!-- disqus end -->

	<!-- related start -->
	<div id="related">
	  <h2>相关内容</h2>
	  <ul class="posts">
	    
	      <li><span>14 Sep 2014</span> &raquo; <a href="/basic-color-theory.html">基础颜色理论（一）</a></li>
	    
	      <li><span>07 Sep 2014</span> &raquo; <a href="/you-should-know-about-dpi.html">移动开发需要知道的像素知识『多图』</a></li>
	    
	      <li><span>17 Aug 2014</span> &raquo; <a href="/learn-vagrant-01.html">Vagrant介绍</a></li>
	    
	      <li><span>10 Aug 2014</span> &raquo; <a href="/zhongyuanjie.html">中元節</a></li>
	    
	      <li><span>26 Jul 2014</span> &raquo; <a href="/learn-chef-02.html">Chef入门（二）</a></li>
	    
	  </ul>
	</div>
	<!-- related end -->
</div>
  
<div class="footer"></div>
<div class="power">  
  Powered by <a href="http://github.com/" targe="_blank">Github</a> &nbsp;&amp;&amp;&nbsp; <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> 
</div>
</div>

<a href="http://github.com/jeremywei" target="_blank">
	<img class="right-banner first" src="http://s0-weizhifeng-net.b0.upaiyun.com/images/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub" />
</a>

<a href="http://www.phptherightway.com" target="_blank">
    <img class="right-banner second" src="http://s0-weizhifeng-net.b0.upaiyun.com/images/php-the-right-way-120x60.png" alt="PHP: The Right Way"/>
</a>
</body>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-5179718-7']);
  _gaq.push(['_setDomainName', 'weizhifeng.net']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</html>