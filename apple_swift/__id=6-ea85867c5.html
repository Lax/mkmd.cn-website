<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>

	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="Author" content="Apple Inc." />
<meta name="viewport" content="width=device-width" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="icon" href="/favicon.ico" />
<link rel="stylesheet" href="https://devimages.apple.com.edgekey.net/assets/core/styles/base.css" type="text/css" />
<link rel="stylesheet" href="/assets/core/styles/templates.css" type="text/css" />
<link rel="stylesheet" href="/assets/core/styles/responsify.css" type="text/css" />
<script src="https://devimages.apple.com.edgekey.net/assets/core/scripts/lib/prototype.js" type="text/javascript" charset="utf-8"></script>
<script src="https://devimages.apple.com.edgekey.net/assets/core/scripts/lib/scriptaculous.js" type="text/javascript" charset="utf-8"></script>
<script src="https://devimages.apple.com.edgekey.net/assets/core/scripts/browserdetect.js" type="text/javascript" charset="utf-8"></script>
<script src="https://devimages.apple.com.edgekey.net/assets/core/scripts/apple_core.js" type="text/javascript" charset="utf-8"></script>
<script src="https://devimages.apple.com.edgekey.net/assets/core/scripts/search_decorator.js" type="text/javascript" charset="utf-8"></script>
<script src="https://devimages.apple.com.edgekey.net/assets/core/scripts/adc_core.js" type="text/javascript" charset="utf-8"></script>
<script src="https://devimages.apple.com.edgekey.net/assets/scripts/ac_retina.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
	document.write('<link rel="stylesheet" type="text/css" href="https://devimages.apple.com.edgekey.net/assets/styles/script.css" media="screen">');
</script>
<!-- Augmented Search -->
<link rel="stylesheet" href="https://devimages.apple.com.edgekey.net/assets/styles/augmented_search.css" type="text/css">
<script src="https://devimages.apple.com.edgekey.net/assets/scripts/lib/jquery/jquery-1.11.0.min.js"></script>
<script>jQuery.noConflict();</script>
<script src="https://devimages.apple.com.edgekey.net/assets/scripts/augmented_search.js"></script>
	<title>Interacting with C Pointers - Swift Blog - Apple Developer</title>
	<meta name="omni-page" content="Interacting with C Pointers - Swift Blog - Apple Developer" />
	<meta name="Description" content="Get the latest news and helpful tips on the Swift programming language from the engineers who created it.">
	<link href="/swift/styles/swift.css" rel="stylesheet" type="text/css">
</head>
<body class="white responsify swift-blog">

	<div id="globalheader-wrapper">
<nav id="globalheader" data-hires="true">
	
	<h1 data-hires="true"><a href="/">Apple Developer</a></h1>
	<ul id="gh-nav">
		<li id="gh-nav-technologies"><a href="/technologies/">Technologies</a></li>
		<li id="gh-nav-resources"><a href="/resources/">Resources</a></li>
		<li id="gh-nav-programs"><a href="/programs/">Programs</a></li>
		<li id="gh-nav-support"><a href="/support/">Support</a></li>
		<li id="gh-nav-membercenter"><a href="/membercenter/">Member Center</a></li>
	</ul>

	<div id="gh-search" data-hires="true">
		<form action="/search/index.php" method="get" accept-charset="utf-8"><div>
			<label for="gh-adcsearch">
				<span class="prettyplaceholder"></span>
				<input type="text" name="q" id="gh-adcsearch" class="adcsearch prettysearch augmented">
			</label>
		</div></form>
	</div>

	<script type="text/javascript">
		Event.onDOMReady(function() {
			// Get root path for Global Header Active class
			ghLocation = location.pathname.split('/')[1];
			// Make sure it doesn't try to add a file extension to the css class
			if(ghLocation.include('.')) ghLocation = ghLocation.split('.')[0];
			// Add Global Header Active State Class
			$$('body')[0].addClassName('gh-nav-'+location.pathname.split('/')[1]+'-active');
		});
	</script>
</nav>
</div>
	<div id="top">
<!-- SiteCatalyst code version: H.8. Copyright 1997-2006 Omniture, Inc. -->
<script type="text/javascript">
/* RSID: */
var s_account="appleglobal,appleusdeveloper"
</script>

<script type="text/javascript" src="https://www.apple.com/metrics/scripts/s_code_h.js"></script>
<script type="text/javascript">
s.pageName=AC.Tracking.pageName();
s.channel="www.us.developer"

/************* DO NOT ALTER ANYTHING BELOW THIS LINE ! **************/
var s_code=s.t();if(s_code)document.write(s_code)</script>
<!-- End SiteCatalyst code version: H.8. -->
</div>	<!-- - -->
<div class="swift-header-container" data-hires="true">
    <div class="swift-header">
        <p class="imagereplace">Swift: A new programming language for iOS and OS X.</p>
    </div>
</div>
<!-- - -->

	<div id="content" class="content responsify" data-hires="true">
		<section class="layout-tabs">
			<div class="tab-wrapper">
				<div class="divider"></div>
				<div class="grid3col tabs">
					<div class="column one"><a href="/swift/">Overview</a></div>
					<div class="column two active"><a href="/swift/blog/">Blog</a></div>
					<div class="column three"><a href="/swift/resources/">Resources</a></div>
				</div>
			</div>
		</section>

		<section class="blog-articles padding-bottom-70">
						<ul class="article-list">
													<li id="article-6" class="article padding-top-50 ">
						<p class="article-date lighter">Jul 28, 2014</p>
												<h2>Interacting with C Pointers</h2>
						
						<span><p>Objective-C and C APIs often require the use of pointers. Data types in Swift are designed to feel natural when working with pointer-based Cocoa APIs, and Swift automatically handles several of the most common use cases for pointers as arguments. In this post we’ll look at how pointer parameters in C can be used with the variables, arrays, and strings in Swift.</p> <h3>Pointers as In/Out Parameters</h3> <p>C and Objective-C don’t support multiple return values, so Cocoa APIs frequently use pointers as a way of passing additional data in and out of functions. Swift allows pointer parameters to be treated like <span class="keyword">inout</span> parameters, so you can pass a reference to a <span class="keyword">var</span> as a pointer argument by using the same <span class="keyword">&</span> syntax. For instance, <span class="keyword">UIColor</span>’s <span class="keyword">getRed(_:green:blue:alpha:)</span> method takes four <span class="keyword">CGFloat*</span> pointers to receive the components of the color. We can use <span class="keyword">&</span> to collect these components into local variables:</p> <pre><code><span class="key">var</span> r: <span class="title">CGFloat</span> = <span class="number">0</span>, g: <span class="title">CGFloat</span> = <span class="numner">0</span>, b: <span class="title">CGFloat</span> = <span class="number">0</span>, a: <span class="title">CGFloat</span> = <span class="number">0</span>
color.getRed(&<span class="pointer">r</span>, green: &<span class="pointer">g</span>, blue: &<span class="pointer">b</span>, alpha: &<span class="pointer">a</span>)</code></pre> <p>Another common case is the Cocoa <span class="keyword">NSError</span> idiom. Many methods take an <span class="keyword">NSError**</span> parameter to save an error in case of failure. For instance, we can list the contents of a directory using <span class="keyword">NSFileManager</span>’s <span class="keyword">contentsOfDirectoryAtPath(_:error:)</span> method, saving the potential error directly to an <span class="keyword">NSError?</span> variable:</p> <pre><code><span class="key">var</span> maybeError: <span class="title">NSError</span>?
<span class="key">if let</span> contents = <span class="title">NSFileManager</span>.<span class="method">defaultManager</span>()
	.<span class="method">contentsOfDirectoryAtPath</span>(<span class="string">"/usr/bin"</span>, error: &<span class="pointer">maybeError</span>) {
	<span class="comment">// Work with the directory contents</span>
} <span class="key">else if let</span> error = <span class="pointer">maybeError</span> {
	<span class="comment">// Handle the error</span>
}</code></pre> <p>For safety, Swift requires the variables to be initialized before being passed with <span class="keyword">&</span>. This is because it cannot know whether the method being called tries to read from a pointer before writing to it.</p> <h3>Pointers as Array Parameters</h3> <p>Pointers are deeply intertwined with arrays in C, and Swift facilitates working with array-based C APIs by allowing <span class="keyword">Array</span> to be used as a pointer argument. An immutable array value can be passed directly as a <span class="keyword">const</span> pointer, and a mutable array can be passed as a non-<span class="keyword">const</span> pointer argument using the <span class="keyword">&</span> operator, just like an <span class="keyword">inout</span> parameter. For instance, we can add two arrays <span class="keyword">a</span> and <span class="keyword">b</span> using the <span class="keyword">vDSP_vadd</span> function from the Accelerate framework, writing the result to a third <span class="keyword">result</span> array:</p> <pre><code><span class="key">import</span> Accelerate

<span class="key">let</span> a: [<span class="title">Float</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]
<span class="key">let</span> b: [<span class="title">Float</span>] = [<span class="number">0.5</span>, <span class="number">0.25</span>, <span class="number">0.125</span>, <span class="number">0.0625</span>]
<span class="key">var</span> result: [<span class="title">Float</span>] = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]

<span class="method">vDSP_vadd</span>(a, <span class="number">1</span>, b, <span class="number">1</span>, &<span class="pointer">result</span>, <span class="number">1</span>, <span class="number">4</span>)

<span class="comment">// result now contains [1.5, 2.25, 3.125, 4.0625]</span></code></pre> <h3>Pointers as String Parameters</h3> <p>C uses <span class="keyword">const char*</span> pointers as the primary way to pass around strings. A Swift <span class="keyword">String</span> can be used as a <span class="keyword">const char*</span> pointer, which will pass the function a pointer to a null-terminated, UTF–8-encoded representation of the string. For instance, we can pass strings directly to standard C and POSIX library functions:</p> <pre><code><span class="method">puts</span>(<span class="string">"Hello from libc"</span>)
<span class="key">let</span> fd = <span class="method">open</span>(<span class="string">"/tmp/scratch.txt"</span>, <span class="title">O_WRONLY</span>|<span class="title">O_CREAT</span>, <span class="number">0o666</span>)

<span class="key">if</span> <span class="pointer">fd</span> &lt; <span class="number">0</span> {
	<span class="method">perror</span>(<span class="string">"could not open /tmp/scratch.txt"</span>)
} <span class="key">else</span> {
	<span class="key">let</span> text = <span class="string">"Hello World"</span>
	<span class="method">write</span>(<span class="pointer">fd</span>, text, <span class="method">strlen</span>(text))
	<span class="method">close</span>(<span class="pointer">fd</span>)
}</code></pre> <h3>Safety with Pointer Argument Conversions</h3> <p>Swift works hard to make interaction with C pointers convenient, because of their pervasiveness within Cocoa, while providing some level of safety. However, interaction with C pointers is inherently unsafe compared to your other Swift code, so care must be taken. In particular:</p> <ul> <li>These conversions cannot safely be used if the callee saves the pointer value for use after it returns. The pointer that results from these conversions is only guaranteed to be valid for the duration of a call. Even if you pass the same variable, array, or string as multiple pointer arguments, you could receive a different pointer each time. An exception to this is global or static stored variables. You can safely use the address of a global variable as a persistent unique pointer value, e.g.: as a KVO context parameter.</li> <li>Bounds checking is not enforced when a pointer to an <span class="keyword">Array</span> or <span class="keyword">String</span> is passed. A C-based API can’t grow the array or string, so you must ensure that the array or string is of the correct size before passing it over to the C-based API.</li></ul> <p>If you need to work with pointer-based APIs that don’t follow these guidelines, or you need to override Cocoa methods that accept pointer parameters, then you can work directly with raw memory in Swift using unsafe pointers. We’ll look at a more advanced case in a future post.</p></span>
												<a class="arrow arrow-left" href="http://developer.apple.com/swift/blog/#article-6">All Blog Posts</a>
											</li>
											</section>

	</div><!-- /content -->

	<div id="globalfooter-wrapper">
		<footer id="globalfooter">
			<div id="breadory">
				<ol id="breadcrumbs">
					<li class="home"><a href="/">Developer</a></li>
					<li><a href="/swift/">Swift</a></li>
										<li><a href="/swift/blog/">Blog</a></li>
					<li>Interacting with C Pointers</li>
									</ol>
			</div><!--/breadory-->
			<p class="gf-buy">Shop the <a href="http://www.apple.com/store/">Apple Online Store</a> (1-800-MY-APPLE), visit an <a href="http://www.apple.com/retail/">Apple Retail Store</a>, or find a <a href="http://www.apple.com/buy/locator/">reseller</a>.</p>
<ul class="gf-links piped">
	<li><a href="/news/" class="first">News</a></li>
	<li><a href="/register/">Register</a></li>
	<li><a href="/bug-reporting/">Report Bugs</a></li>
	<li><a href="/contact/">Contact Us</a></li>
</ul>
<div class="gf-sosumi">
	<p>Copyright © 2014 Apple Inc. All rights reserved.</p>
	<ul class="piped">
		<li><a href="http://www.apple.com/legal/internet-services/terms/site.html" class="first">Terms of Use</a></li>
		<li><a href="http://www.apple.com/privacy/">Privacy Policy</a></li>
	</ul>
</div>
<div id="localization-links">
	<ul>
		<li><a href="/cn/" title="Simplified Chinese">简体中文</a></li>
		<li><a href="/jp/" title="Japanese">日本語</a></li>
		<li><a href="/kr/" title="Korean">한국어</a></li>
	</ul>
</div>		</footer><!--/globalfooter-->
	</div><!-- /globalfooter-wrapper -->
</body>
</html>