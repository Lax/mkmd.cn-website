<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>

	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="Author" content="Apple Inc." />
<meta name="viewport" content="width=device-width" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="icon" href="/favicon.ico" />
<link rel="stylesheet" href="https://devimages.apple.com.edgekey.net/assets/core/styles/base.css" type="text/css" />
<link rel="stylesheet" href="/assets/core/styles/templates.css" type="text/css" />
<link rel="stylesheet" href="/assets/core/styles/responsify.css" type="text/css" />
<script src="https://devimages.apple.com.edgekey.net/assets/core/scripts/lib/prototype.js" type="text/javascript" charset="utf-8"></script>
<script src="https://devimages.apple.com.edgekey.net/assets/core/scripts/lib/scriptaculous.js" type="text/javascript" charset="utf-8"></script>
<script src="https://devimages.apple.com.edgekey.net/assets/core/scripts/browserdetect.js" type="text/javascript" charset="utf-8"></script>
<script src="https://devimages.apple.com.edgekey.net/assets/core/scripts/apple_core.js" type="text/javascript" charset="utf-8"></script>
<script src="https://devimages.apple.com.edgekey.net/assets/core/scripts/search_decorator.js" type="text/javascript" charset="utf-8"></script>
<script src="https://devimages.apple.com.edgekey.net/assets/core/scripts/adc_core.js" type="text/javascript" charset="utf-8"></script>
<script src="https://devimages.apple.com.edgekey.net/assets/scripts/ac_retina.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
	document.write('<link rel="stylesheet" type="text/css" href="https://devimages.apple.com.edgekey.net/assets/styles/script.css" media="screen">');
</script>
<!-- Augmented Search -->
<link rel="stylesheet" href="https://devimages.apple.com.edgekey.net/assets/styles/augmented_search.css" type="text/css">
<script src="https://devimages.apple.com.edgekey.net/assets/scripts/lib/jquery/jquery-1.11.0.min.js"></script>
<script>jQuery.noConflict();</script>
<script src="https://devimages.apple.com.edgekey.net/assets/scripts/augmented_search.js"></script>
	<title>Optionals Case Study:  valuesForKeys  - Swift Blog - Apple Developer</title>
	<meta name="omni-page" content="Optionals Case Study:  valuesForKeys  - Swift Blog - Apple Developer" />
	<meta name="Description" content="Get the latest news and helpful tips on the Swift programming language from the engineers who created it.">
	<link href="/swift/styles/swift.css" rel="stylesheet" type="text/css">
</head>
<body class="white responsify swift-blog">

	<div id="globalheader-wrapper">
<nav id="globalheader" data-hires="true">
	
	<h1 data-hires="true"><a href="/">Apple Developer</a></h1>
	<ul id="gh-nav">
		<li id="gh-nav-technologies"><a href="/technologies/">Technologies</a></li>
		<li id="gh-nav-resources"><a href="/resources/">Resources</a></li>
		<li id="gh-nav-programs"><a href="/programs/">Programs</a></li>
		<li id="gh-nav-support"><a href="/support/">Support</a></li>
		<li id="gh-nav-membercenter"><a href="/membercenter/">Member Center</a></li>
	</ul>

	<div id="gh-search" data-hires="true">
		<form action="/search/index.php" method="get" accept-charset="utf-8"><div>
			<label for="gh-adcsearch">
				<span class="prettyplaceholder"></span>
				<input type="text" name="q" id="gh-adcsearch" class="adcsearch prettysearch augmented">
			</label>
		</div></form>
	</div>

	<script type="text/javascript">
		Event.onDOMReady(function() {
			// Get root path for Global Header Active class
			ghLocation = location.pathname.split('/')[1];
			// Make sure it doesn't try to add a file extension to the css class
			if(ghLocation.include('.')) ghLocation = ghLocation.split('.')[0];
			// Add Global Header Active State Class
			$$('body')[0].addClassName('gh-nav-'+location.pathname.split('/')[1]+'-active');
		});
	</script>
</nav>
</div>
	<div id="top">
<!-- SiteCatalyst code version: H.8. Copyright 1997-2006 Omniture, Inc. -->
<script type="text/javascript">
/* RSID: */
var s_account="appleglobal,appleusdeveloper"
</script>

<script type="text/javascript" src="https://www.apple.com/metrics/scripts/s_code_h.js"></script>
<script type="text/javascript">
s.pageName=AC.Tracking.pageName();
s.channel="www.us.developer"

/************* DO NOT ALTER ANYTHING BELOW THIS LINE ! **************/
var s_code=s.t();if(s_code)document.write(s_code)</script>
<!-- End SiteCatalyst code version: H.8. -->
</div>	<!-- - -->
<div class="swift-header-container" data-hires="true">
    <div class="swift-header">
        <p class="imagereplace">Swift: A new programming language for iOS and OS X.</p>
    </div>
</div>
<!-- - -->

	<div id="content" class="content responsify" data-hires="true">
		<section class="layout-tabs">
			<div class="tab-wrapper">
				<div class="divider"></div>
				<div class="grid3col tabs">
					<div class="column one"><a href="/swift/">Overview</a></div>
					<div class="column two active"><a href="/swift/blog/">Blog</a></div>
					<div class="column three"><a href="/swift/resources/">Resources</a></div>
				</div>
			</div>
		</section>

		<section class="blog-articles padding-bottom-40">
						<ul class="article-list">
													<li id="article-12" class="article padding-top-50 padding-bottom-50 ">
						<p class="article-date lighter">Aug 27, 2014</p>
						<h2>
														Optionals Case Study: <span class="menlo">valuesForKeys</span>
													</h2>

						<p>This post explores how optionals help preserve strong type safety within Swift. We’re going to create a Swift version of an Objective-C API. Swift doesn’t really need this API, but it makes for a fun example.</p><p>In Objective-C, <span class="keyword">NSDictionary</span> has a method <span class="keyword">-objectsForKeys:notFoundMarker:</span> that takes an <span class="keyword">NSArray</span> of keys, and returns an <span class="keyword">NSArray</span> of corresponding values. From the documentation: “the <em>N</em>-th object in the returned array corresponds to the <em>N</em>-th key in [the input parameter] keys.” What if the third key isn’t actually in the dictionary? That’s where the <span class="keyword">notFoundMarker</span> parameter comes in. The third element in the array will be this marker object rather than a value from the dictionary. The Foundation framework even provides a class for this case if you don’t have another to use: <span class="keyword">NSNull</span>.</p><p>In Swift, the <span class="keyword">Dictionary</span> class doesn’t have an <span class="keyword">objectsForKeys</span> equivalent. For this exercise, we’re going to add one — as <span class="keyword">valuesForKeys</span> in keeping with the common use of ‘value’ in Swift — using an extension:</p><pre><code><span class="key">extension</span> <span class="title">Dictionary</span> {
	<span class="key">func</span> valuesForKeys(keys: [<span class="title">K</span>], notFoundMarker: <span class="title">V</span>) -&gt; [<span class="title">V</span>] {
		<span class="comment">// To be implemented</span>
	}
}</code></pre><p>This is where our new implementation in Swift will differ from Objective-C. In Swift, the stronger typing restricts the resulting array to contain only a single type of element — we can’t put <span class="keyword">NSNull</span> in an array of strings. However, Swift gives an even better option: we can return an <em>array of optionals</em>. All our values get wrapped in optionals, and instead of <span class="keyword">NSNull</span>, we just use <span class="keyword">nil</span>.</p><pre><code><span class="key">extension</span> <span class="title">Dictionary</span> {
	<span class="key">func</span> valuesForKeys(keys: [<span class="title">Key</span>]) -&gt; [<span class="title">Value</span>?] {
		<span class="key">var</span> result = [Value?]()
		result.reserve(keys.count)
		<span class="key">for</span> key <span class="key">in</span> keys {
			result.<span class="method">append</span>(<span class="method">self</span>[key])
		}
		<span class="key">return</span> result
	}
}</code></pre><p>NOTE: Some of you may have guessed why a Swift <span class="keyword">Dictionary</span> doesn’t need this API, and already imagined something like this:</p><pre><code><span class="key">extension</span> <span class="title">Dictionary</span> {
	<span class="key">func</span> valuesForKeys(keys: [<span class="title">Key</span>]) -&gt; [<span class="title">Value</span>?] {
		<span class="key">return</span> keys.<span class="method">map</span> { <span class="method">self</span>[$0] }
	}
}</code></pre><p>This has the exact same effect as the imperative version above, but all of the boilerplate has been wrapped up in the call to <span class="keyword">map</span>. This is great example why Swift types often have a small API surface area, because it’s so easy to just call <span class="keyword">map</span> directly.</p><p>Now we can try out some examples:</p><pre><code><span class="key">let</span> dict = [<span class="string">"A"</span>: <span class="string">"Amir"</span>, <span class="string">"B"</span>: <span class="string">"Bertha"</span>, <span class="string">"C"</span>: <span class="string">"Ching"</span>]

<span class="pointer">dict</span>.<span class="enum">valuesForKeys</span>([<span class="string">"A"</span>, <span class="string">"C"</span>])
<span class="comment">// [Optional("Amir"), Optional("Ching")]</span>

<span class="pointer">dict</span>.<span class="enum">valuesForKeys</span>([<span class="string">"B"</span>, <span class="string">"D"</span>])
<span class="comment">// [Optional("Bertha"), nil]</span>

<span class="pointer">dict</span>.<span class="enum">valuesForKeys</span>([])
<span class="comment">// []</span></code></pre><h3>Nested Optionals</h3><p>Now, what if we asked for the <span class="keyword">last</span> element of each result?</p><pre><code><span class="pointer">dict</span>.<span class="enum">valuesForKeys</span>([<span class="string">"A"</span>, <span class="string">"C"</span>]).<span class="title">last</span>
<span class="comment">// Optional(Optional("Ching"))</span>

<span class="pointer">dict</span>.<span class="enum">valuesForKeys</span>([<span class="string">"B"</span>, <span class="string">"D"</span>]).<span class="title">last</span>
<span class="comment">// Optional(nil)</span>

<span class="pointer">dict</span>.<span class="enum">valuesForKeys</span>([]).<span class="title">last</span>
<span class="comment">// nil</span></code></pre><p>That’s strange — we have two levels of <span class="keyword">Optional</span> in the first case, and <span class="keyword">Optional(nil)</span> in the second case. What’s going on?</p><p>Remember the declaration of the <span class="keyword">last</span> property:</p><pre><code><span class="key">var</span> last: <span class="title">T</span>? { get }</code></pre><p>This says that the <span class="keyword">last</span> property’s type is an <span class="keyword">Optional</span> version of the array’s element type. In <em>this</em> case, the element type is also optional (<span class="keyword">String?</span>). So we end up with <span class="keyword">String??</span>, a doubly-nested optional type.</p><p>So what does <span class="keyword">Optional(nil)</span> mean?</p><p>Recall that in Objective-C we were going to use <span class="keyword">NSNull</span> as a placeholder. The Objective-C version of these three calls looks like this:</p><pre><code>[<span class="pointer">dict</span> valuesForKeys:@[@<span class="string">"A"</span>, @<span class="string">"C"</span>] notFoundMarker:[NSNull null]].lastObject
<span class="comment">// @"Ching"</span>

[<span class="pointer">dict</span> valuesForKeys:@[@<span class="string">"B"</span>, @<span class="string">"D"</span>] notFoundMarker:[NSNull null]].lastObject
<span class="comment">// NSNull</span>

[<span class="pointer">dict</span> valuesForKeys:@[] notFoundMarker:[NSNull null]].lastObject
<span class="comment">// nil</span></code></pre><p>In both the Swift and Objective-C cases, a return value of <span class="keyword">nil</span> means “the array is empty, therefore there’s no last element.” The return value of <span class="keyword">Optional(nil)</span> (or in Objective-C <span class="keyword">NSNull</span>) means “the last element of this array exists, but it represents an absence.” Objective-C has to rely on a placeholder object to do this, but Swift can represent it in the type system.</p><h3>Providing a Default</h3><p>To wrap up, what if you <em>did</em> want to provide a default value for anything that wasn’t in the dictionary? Well, that’s easy enough.</p><pre><code><span class="key">extension</span> <span class="title">Dictionary</span> {
	<span class="key">func</span> valuesForKeys(keys: [<span class="title">Key</span>], notFoundMarker: <span class="title">Value</span>) -&gt; [<span class="title">Value</span>] {
		<span class="key">return self</span>.<span class="enum">valuesForKeys</span>(keys).<span class="method">map</span> { $0 <span class="method">??</span> notFoundMarker }
	}
}


<span class="pointer">dict</span>.<span class="enum">valuesForKeys</span>([<span class="string">"B"</span>, <span class="string">"D"</span>], notFoundMarker: <span class="string">"Anonymous"</span>)
<span class="comment">// ["Bertha", "Anonymous"]</span></code></pre><p>While Objective-C has to rely on a placeholder object to do this, Swift can represent it in the type system, and provides rich syntactic support for handling optional results.</p>

						
												<a class="arrow arrow-left" href="http://developer.apple.com/swift/blog/#article-12">All Blog Posts</a>
											</li>
											</section>

	</div><!-- /content -->

	<div id="globalfooter-wrapper">
		<footer id="globalfooter">
			<div id="breadory">
				<ol id="breadcrumbs">
					<li class="home"><a href="/">Developer</a></li>
					<li><a href="/swift/">Swift</a></li>
										<li><a href="/swift/blog/">Blog</a></li>
					<li>Optionals Case Study: <span class="menlo">valuesForKeys</span></li>
									</ol>
			</div><!--/breadory-->
			<p class="gf-buy">Shop the <a href="http://www.apple.com/store/">Apple Online Store</a> (1-800-MY-APPLE), visit an <a href="http://www.apple.com/retail/">Apple Retail Store</a>, or find a <a href="http://www.apple.com/buy/locator/">reseller</a>.</p>
<ul class="gf-links piped">
	<li><a href="/news/" class="first">News</a></li>
	<li><a href="/register/">Register</a></li>
	<li><a href="/bug-reporting/">Report Bugs</a></li>
	<li><a href="/contact/">Contact Us</a></li>
</ul>
<div class="gf-sosumi">
	<p>Copyright © 2014 Apple Inc. All rights reserved.</p>
	<ul class="piped">
		<li><a href="http://www.apple.com/legal/internet-services/terms/site.html" class="first">Terms of Use</a></li>
		<li><a href="http://www.apple.com/privacy/">Privacy Policy</a></li>
	</ul>
</div>
<div id="localization-links">
	<ul>
		<li><a href="/cn/" title="Simplified Chinese">简体中文</a></li>
		<li><a href="/jp/" title="Japanese">日本語</a></li>
		<li><a href="/kr/" title="Korean">한국어</a></li>
	</ul>
</div>		</footer><!--/globalfooter-->
	</div><!-- /globalfooter-wrapper -->
</body>
</html>