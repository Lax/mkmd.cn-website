<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>LISA13 Metrics Workshop</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/blog/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/blog/css/main.css">

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-7747513-3']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

    </head>
    <body>

	<div class="nav">
	<p class="navhdr">This Site:</p>
<a href="/index.html">Homepage</a><br>
<a href="/blog/index.html">Blog</a><br>
<a href="/sitemap.html">Full Site Map</a><br>
<a href="/sysperfbook.html">Sys Perf book</a><br>
<a href="/linuxperf.html">Linux Perf</a><br>
<a href="/methodology.html">Perf Methods</a><br>
<a href="/usemethod.html">USE Method</a><br>
<a href="/tsamethod.html">TSA Method</a><br>
<a href="/offcpuanalysis.html">Off-CPU Analysis</a><br>
<a href="/activebenchmarking.html">Active Bench.</a><br>
<a href="/flamegraphs.html">Flame Graphs</a><br>
<a href="/heatmaps.html">Heat Maps</a><br>
<a href="/frequencytrails.html">Frequency Trails</a><br>
<a href="/colonygraphs.html">Colony Graphs</a><br>
<a href="/perf.html">perf Examples</a><br>
<a href="/ktap.html">ktap Examples</a><br>
<a href="/dtrace.html">DTrace Tools</a><br>
<a href="/dtracetoolkit.html">DTraceToolkit</a><br>
<a href="/dtkshdemos.html">DtkshDemos</a><br>
<a href="/guessinggame.html">Guessing Game</a><br>
<a href="/specials.html">Specials</a><br>
<a href="/books.html">Books</a><br>
<a href="/sites.html">Other Sites</a><br>

	</div>

	<div class="recent">
	Recent posts:<br>
	<ul style="padding-left:18px">
	  
		   <li>30 Aug 2014 &raquo;<br>
		   <a href="/blog/2014-08-30/ftrace-the-hidden-light-switch.html">  
		   ftrace: The Hidden Light Switch</a></li>
	  
		   <li>23 Aug 2014 &raquo;<br>
		   <a href="/blog/2014-08-23/linux-perf-tools-linuxcon-na-2014.html">  
		   Linux Performance Tools at LinuxCon North America 2014</a></li>
	  
		   <li>28 Jul 2014 &raquo;<br>
		   <a href="/blog/2014-07-28/execsnoop-for-linux.html">  
		   execsnoop For Linux: See Short-Lived Processes</a></li>
	  
		   <li>25 Jul 2014 &raquo;<br>
		   <a href="/blog/2014-07-25/opensnoop-for-linux.html">  
		   opensnoop For Linux</a></li>
	  
		   <li>23 Jul 2014 &raquo;<br>
		   <a href="/blog/2014-07-23/linux-iosnoop-latency-heat-maps.html">  
		   Linux iosnoop Latency Heat Maps</a></li>
	  
		   <li>16 Jul 2014 &raquo;<br>
		   <a href="/blog/2014-07-16/iosnoop-for-linux.html">  
		   iosnoop For Linux</a></li>
	  
		   <li>13 Jul 2014 &raquo;<br>
		   <a href="/blog/2014-07-13/linux-ftrace-function-counting.html">  
		   Linux ftrace Function Counting</a></li>
	  
		   <li>10 Jul 2014 &raquo;<br>
		   <a href="/blog/2014-07-10/perf-hacktogram.html">  
		   perf Hacktogram</a></li>
	  
		   <li>03 Jul 2014 &raquo;<br>
		   <a href="/blog/2014-07-03/perf-counting.html">  
		   perf Counting</a></li>
	  
		   <li>01 Jul 2014 &raquo;<br>
		   <a href="/blog/2014-07-01/perf-heat-maps.html">  
		   perf Heat Maps</a></li>
	  
		   <li>29 Jun 2014 &raquo;<br>
		   <a href="/blog/2014-06-29/perf-static-tracepoints.html">  
		   perf Static Tracepoints</a></li>
	  
		   <li>22 Jun 2014 &raquo;<br>
		   <a href="/blog/2014-06-22/perf-cpu-sample.html">  
		   perf CPU Sampling</a></li>
	  
		   <li>12 Jun 2014 &raquo;<br>
		   <a href="/blog/2014-06-12/java-flame-graphs.html">  
		   Java Flame Graphs</a></li>
	  
		   <li>09 Jun 2014 &raquo;<br>
		   <a href="/blog/2014-06-09/java-cpu-sampling-using-hprof.html">  
		   Java CPU Sampling Using hprof</a></li>
	  
		   <li>23 May 2014 &raquo;<br>
		   <a href="/blog/2014-05-23/osx-10.9.3-is-toxic.html">  
		   OS X 10.9.3 Recurring Panics</a></li>
	  
		   <li>17 May 2014 &raquo;<br>
		   <a href="/blog/2014-05-17/free-as-in-we-own-your-ip.html">  
		   Free, as in, We Own Your IP</a></li>
	  
		   <li>16 May 2014 &raquo;<br>
		   <a href="/blog/2014-05-16/LISA13-metrics-workshop.html">  
		   LISA13 Metrics Workshop</a></li>
	  
		   <li>11 May 2014 &raquo;<br>
		   <a href="/blog/2014-05-11/strace-wow-much-syscall.html">  
		   strace Wow Much Syscall</a></li>
	  
		   <li>09 May 2014 &raquo;<br>
		   <a href="/blog/2014-05-09/xen-feature-detection.html">  
		   Xen Feature Detection</a></li>
	  
		   <li>07 May 2014 &raquo;<br>
		   <a href="/blog/2014-05-07/what-color-is-your-xen.html">  
		   What Color Is Your Xen?</a></li>
	  
	</ul>
	<a href="/blog/index.html">Blog index</a><br>
	<a href="/blog/about.html">About</a><br>
	<a href="/blog/rss.xml">RSS</a><br>
	</div>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/blog/index.html">Brendan Gregg's Blog</a></h1>
            <a class="extra" href="/blog/index.html">home</a>
          </div>

          <h2 class="big">LISA13 Metrics Workshop</h2>
<p class="meta">16 May 2014</p>

<div class="post">
<div style="float:right;padding:0px 10px 10px 20px"><a href="/blog/images/2014/brendan-workshop-bw-600.png"><img border=0 src="/blog/images/2014/brendan-workshop-bw-600.png" width=300></a></div>

<p>At USENIX LISA`13 I helped run a <a href="https://www.usenix.org/conference/lisa13/workshops/metrics">Metrics Workshop</a>, along with Narayan Desai (Argonne National Laboratory), Kent SkaarÂ (VMware, Inc.), Theo Schlossnagle (OmniTI), and Caskey Dickson (Google). This was an opportunity for many industry professionals to discuss problems with performance metrics and monitoring, and to propose and discuss solutions. It was a lot of fun, and was very useful to hear the different opinions and perspectives from those who attended.</p>

<p>We provided guidance for choosing more effective performance metrics, which involved helping people think more freely and creatively, instead of being bounded by the metrics that are currently or typically offered. I also covered key methodologies, including the USE Method, which provide a checklist of concise metrics that are designed to solve issues. I ended the day with five minute lightning talks on <a href="http://www.youtube.com/watch?v=HKmgdLcx8jQ">statistics and visualizations</a>.</p>

<p>There were about 30 participants, and <a href="http://www.beginningwithi.com">Deirdr&eacute; Straughan</a> videoed the entire day long event, which includes the talks by the other moderators. The videos are on <a href="http://www.youtube.com/playlist?list=PL3oXECC9Rpm2BL0v1W7cgyj8eV9d44icc">youtube</a>:</p>

<p><center><iframe width="560" height="315" src="//www.youtube.com/embed/videoseries?list=PL3oXECC9Rpm2BL0v1W7cgyj8eV9d44icc" frameborder="0" allowfullscreen></iframe></center></p>

<p>As an exercise, we identified several targets of performance monitoring, formed groups to propose ideal metrics, then presented and discussed these metrics. I&#39;ve listed a summary of the metrics below, and also submitted them to the monitoringsucks project on <a href="https://github.com/monitoringsucks/metrics-catalog/pull/1">github</a>.</p>

<h2>Network Infrastructure</h2>

<ul>
<li>Physical Infrastructure

<ul>
<li>bandwidth, utilization of individual links</li>
<li>CoS/QoS rate/drops</li>
<li>L2/L2 protocol health</li>
<li>churn</li>
<li>reachabality</li>
</ul></li>
<li>Per port:

<ul>
<li>packets/sec</li>
<li>packet size</li>
<li>buffer utilization</li>
<li>perf flow into:</li>
<li>app injection BW</li>
<li>app injectiov rate</li>
<li>app consumption rate</li>
<li>app consumption BW</li>
</ul></li>
<li>Component:

<ul>
<li>links</li>
<li>errors</li>
<li>latency</li>
<li>utilization</li>
</ul></li>
<li>Topology:

<ul>
<li>app to app latency</li>
<li>app to app low</li>
<li>symmetry</li>
</ul></li>
</ul>

<h2>Configuration</h2>

<ul>
<li>Apps should export flags, to check for consistency

<ul>
<li>a metadata to show the target configuration</li>
</ul></li>
<li>Versioning:

<ul>
<li>ldd, libraries linked against</li>
<li>time a config was applied</li>
</ul></li>
<li>Platform Type:

<ul>
<li>server H/W</li>
</ul></li>
<li>Cost of Configuration

<ul>
<li>cost of configuration upload/download</li>
<li>time to deployment: security changes (high priority), vs others</li>
<li>CPU and RAM usage during configuration</li>
</ul></li>
<li>People

<ul>
<li>deployment report</li>
</ul></li>
<li>Hardware

<ul>
<li>current hardware</li>
<li>max expected performance</li>
</ul></li>
<li>Process

<ul>
<li>compliance measurement of configuration: percent of systems</li>
</ul></li>
<li>Failure

<ul>
<li>failure of configuration deployment</li>
<li>rollbacks, rollforward: config metric didn&#39;t apply</li>
</ul></li>
<li>OS flags</li>
</ul>

<h2>Distributed system</h2>

<ul>
<li>Perceived latency: service time and queueing</li>
<li>Request rate</li>
<li>Error rate</li>
<li>Traffic origins</li>
<li>Histogram of latencies for each server, for comparisons</li>
<li>Visualizations:

<ul>
<li>heatmaps</li>
<li>for service</li>
<li>per server</li>
<li>per backend</li>
<li>system &#39;flame graph&#39;</li>
<li>visualize traffic as graph, queue time, request flow</li>
</ul></li>
</ul>

<h2>Message Queueing</h2>

<ul>
<li>Distribution of message latency (ns)</li>
<li>Throughput</li>
<li>Total number of ns</li>
<li>Errors, drop, retransmits, discards</li>
<li>Message fanout distribution (gain: ratio of input to put)</li>
<li>For distribution message queues: see distributied systems</li>
<li>Queue lengths</li>
<li>Saturation: run out of space</li>
<li>Resource constraints on queueing systems</li>
<li>Last time of access</li>
</ul>

<h2>Web servers</h2>

<ul>
<li>Requests: referrer, origin, UA, resp code, count

<ul>
<li>origin</li>
<li>response code</li>
</ul></li>
<li>Req size: distribution</li>
<li>Response Size: resp code, distribution</li>
<li>Responce Count: resp code, counter</li>
<li>Time To First Bite: resp code, distribution</li>
<li>Time To Last Bite: resp code, distribution</li>
<li>Active Workers: guage</li>
<li>Worker Age: guage</li>
<li>Connections:  counter</li>
<li>Process Metrics from host</li>
</ul>

<h2>Application servers</h2>

<ul>
<li>Total requests served, rate</li>
<li>Latency:

<ul>
<li>time to serve a client</li>
<li>complete a client transaction</li>
<li>request queue time</li>
</ul></li>
<li>App error rate</li>
<li>Error counts on backend H/W</li>
<li>Bandwidth usage front and backend</li>
<li>System load on primary application server: CPU, memory, disk, swapping</li>
<li>Usage patterns:

<ul>
<li>which user, client time, session time, active vs idle time</li>
</ul></li>
</ul>

<h2>Databases</h2>

<ul>
<li>Queries/sec</li>
<li># of connections</li>
<li>connections/sec</li>
<li>avg time per query</li>
<li>cache hit rate</li>
<li>avg io latency</li>
<li>aggregate io</li>
<li>% of query time in io</li>
<li># of locks</li>
<li># of versions (for read consistency)</li>
<li>terminated connects</li>
<li>SQL statements</li>
<li>cache evictions</li>
<li>query errors by type</li>
<li>saturation: plan to execute

<ul>
<li>queueing on pool</li>
</ul></li>
<li>change in number of executed plans</li>
<li>latency of last checkpoint, and on-disk representation of wall log

<ul>
<li>(how much of DB to reply)</li>
</ul></li>
<li>checkpoint times</li>
</ul>

<h2>Resources/Devices</h2>

<ul>
<li>Utilization

<ul>
<li>per-device: eg, as a heat map for distribution over time</li>
</ul></li>
<li>Saturation

<ul>
<li>average queue length, or time waiting on queue</li>
</ul></li>
<li>Errors</li>
</ul>

<p>Thanks to all those who attended and helped out!</p>

</div>



<br><hr>
<div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = 'brendangregg';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


          <div class="footer">
            <div class="contact">
                Copyright 2014 Brendan Gregg.<br><a href="/blog/about.html">About this blog</a>
            </div>
          </div>
        </div>

    </body>
</html>
